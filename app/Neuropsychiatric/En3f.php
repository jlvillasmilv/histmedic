<?php

namespace App\Neuropsychiatric;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;


class En3f extends Model
{
   use SoftDeletes;
	protected $table="en3f";

    protected $fillable = [
	               	'patient_id',
					'user_id',
					'fech_neu',
					'Ano_estudio',
					'Evaluador',
					'marita_a',
					'marita_p',
					'leer',
					'educacio',
					'ocupacio',
					'nombre_inf',
					'parentesco',
					'tlf_inf',
					'tlf_part',
					'ante_psi',
					'mod_tto',
					'tubercul',
					'trau_cra13_1',
					'trau_cra13_2',
					'trau_cra13_3',
					'trau_cra13_4',
					'trau_cra13_5',
					'no_epile',
					'sifilis',
					'cran_sig_16_1',
					'cran_sig_16_2',
					'cran_sig_16_3',
					'cran_sig_16_4',
					'snc',
					'drogas',
					'tipo_drog',
					'fech_drog',
					'alcohol',
					'tipo_alco',
					'cant_alco',
					'freq_alco',
					'fech_alco',
					'coronari',
					'arritmia',
					'arritmia_fech',
					'ins_card',
					'fech_ins_card',
					'diab_mel',
					'fech_diab_mel',
					'medi_diab_mel',
					'nivel_glic',
					'in_renal',
					'fech_in_renal',
					'ulcera',
					'fech_ulcera',
					'broncop',
					'fech_broncop',
					'artritri',
					'fech_artritri',
					'tabaquis',
					'cant_taba',
					'fech_taba',
					'hta',
					'fech_hta',
					'medi_hta',
					'val_hta',
					'ins_vasc',
					'hipotiro',
					'hipertir',
					'dislipid',
					'fech_dislipid',
					'medi_dislipid',
					'dislipid_control',
					'cirr_epa',
					'fech_cirr_epa',
					'epileps',
					'fech_epileps',
					'cancer',
					'fech_cancer',
					'otros_a',
					'fech_otros_a',
					'ante_fam',
					'falle_pa',
					'edad_falle_pa',
					'Causa_falle_pa',
					'falle_ma',
					'edad_falle_ma',
					'causa_falle_ma',
					'Hermanos',
					'hijos',
					'fami_eme',
					'ante_acv',
					'ant_diab',
					'ant_deme',
					'antc_acv',
					'famil_em',
					'warfarin',
					'aines',
					'anti_plq',
					'esteroid',
					'insulina',
					'hipoglis',
					'digital',
					'diuretic',
					'nitratos',
					'calc_ant',
					'beta_blq',
					'ieca',
					'otr_anth',
					'ot_antia',
					'hipolipe',
					'broncodi',
					'estrogen',
					'tiroide',
					'anticoli',
					'dopamine',
					'antidepr',
					'antipsic',
					'benzodia',
					'narcotic',
					'deriv_co',
					'anticonv',
					'inhib_ac',
					'neuroact',
					'prot_gas',
					'antivari',
					'antiox',
					'comple_b',
					'otra_vit',
					'otro_med',
					'inter_me',
					'probl_memori',
					'ingr_hos',
					'menopaus',
					'fech_men',
					'ano_men',
					'tiem_men',
					'tomocran',
					'resonanc',
					'eeg',
					'elecmiog',
					'acv',
					'fecha_acv',
					'mes_acv',
					'ano_acv',
					'perd_con',
					'facia_iz',
					'facia_de',
					'visi_iz',
					'visi_der',
					'cam_leng',
					'miem_iz',
					'miem_der',
					'sens_iz',
					'sens_der',
					'acv_quir',
					'tipo_acv',
					'nÃºm_even',
					'Piel',
					'orl',
					'Cardiova',
					'torax',
					'abdomen',
					'Genitourinario',
					'osteoart',
					'miembros',
					'otros',
					'conscien',
					'tono',
					'refle_iz',
					'refle_der',
					'refle_bra_iz',
					'refle_brizq',
					'refle_cua_iz',
					'refle_cua_der',
					'sen_d_iz',
					'sen_d_de',
					'sen_v_iz',
					'sen_v_de',
					'cines_iz',
					'cines_de',
					'marcha',
					'tras_mot',
					'coordina',
					'romberg',
					'dist_iz',
					'dist_der',
					'sig_lher',
					'habla',
					'campo',
					'movimien',
					'ojo_iz',
					'ojo_de',
					'rinne_iz',
					'rinne_de',
					'weber',
					'otr_pare',
					'temblor',
					'rigidez',
					'bradiqui',
					'march',
					'cap_leva',
					'postura',
					'estabili',
					'pivoteo',
					'bradi_fa',
					'hablar',
					'blecot1',
					'blecot2',
					'blecot3',
					'blecot4',
					'blecot5',
					'blecot6',
					'blecot7',
					'blecot8',
					't_activi',
					'bleha9',
					'bleha10',
					'bleha11',
					'bleha11ex_1',
					'bleha11ex_2',
					'bleha11ex_3',
					't_habito',
					't_funcio',
					'avd_paci',
					'avd_entr',
					'Inf_obt',
					'mme130',
					'mme131',
					'mme132',
					'mme133',
					'max_error_mes',
					'mme134',
					'max_error_ano',
					'mme135',
					'mme136',
					'mme137',
					'mme138',
					'mme139',
					'mme140',
					'mme141a',
					'mme141b',
					'mme141',
					'mme142a',
					'mme142b',
					'mme142c',
					'mme142',
					'mme143a',
					'mme143b',
					'mme143c',
					'mme143',
					'bleav144',
					'bleav145',
					'bleav146',
					'bleav147',
					'bleav147r',
					'mme148a',
					'mme148b',
					'mme148c',
					'mme148d',
					'mme148e',
					'mme148',
					'mme149a',
					'mme149b',
					'mme149c',
					'mme149d',
					'mme149e',
					'mme149f',
					'mme149g',
					'mme149h',
					'mme149i',
					'mme149j',
					'mme149',
					'mme150a',
					'mme150b',
					'mme150',
					'mme151',
					'mme152',
					'mme153',
					'mme154',
					'juicioa',
					'juiciob',
					'juicioc',
					'juiciod',
					'juicioe',
					'juiciof',
					'juiciog',
					'juicioh',
					'juicio',
					'ide_delir',
					'tot_deli',
					'alucinac',
					'tot_aluc',
					'agitacio',
					'tot_agit',
					'depresio',
					'tot_depr',
					'ansiedad',
					'tot_ansi',
					'regocijo',
					'tot_reg',
					'apatia_i',
					'tot_apat',
					'desinhib',
					'tot_desi',
					'irritabi',
					'tot_irri',
					'act_moto',
					'tot_moto',
					'sueno',
					'tot_suen',
					'apetito',
					'tot_apet',
					'EMEMs',
					'EMEMf',
					'bomc',
					'memoria',
					'orient',
					'juicio2',
					'avdi_tot',
					'avdb_tot',
					'memocdr',
					'oriencdr',
					'juiciocdr',
					'actsoccdr',
					'Hogarcdr',
					'cuidadocdr',
					'cdr',
					'ano_sint',
					'edad_sin',
					'comi_cua',
					'cur_cuad',
					'hach1',
					'hach2',
					'hach3',
					'hach4',
					'hach5',
					'hach6',
					'hach7',
					'hach8',
					'esc_hach',
					'sintom_1',
					'diag_dem',
					'enf_park',
					'enf_hunt',
					'mov_farm',
					'disqui_t',
					'escleros',
					'tumor',
					'hakin',
					'temb_esc',
					'trans_ot',
					'sind_amn',
					'aneurism',
					'soplo_ca',
					'cond_eme',
					'psicolog',
    ];

    protected $dates  = ['fech_neu','created_at','updated_at','deleted_at'];
    protected $hidden = ['id','patient_id', 'user_id','user_updated','user_deleted','created_at','updated_at','deleted_at' ];

    public function user()
	{
	    return $this->belongsTo(\App\User::class,'user_id')->withDefault([
	        'name' => 'N/A',
	    ]);
	}

    public function patient() {
        return $this->belongsTo(\App\Patient::class,'patient_id','patient_id')->withDefault([
        		'hist_id' => 0,
        		'cedula' => 0,
        		'first_name' => '',
        		'last_name' => '',
   		 ]);
    }

    public function scopeSearch($query, $search)
    {	  
      $query->join('patient as p','p.patient_id','en3f.patient_id');
      if(trim($search)) {

        return $query->where('p.hist_id', 'LIKE', "%$search%")
					 ->orWhere('p.cedula', 'LIKE', "%$search%")
					 ->orWhere(\DB::RAW("CONCAT_WS(' ',p.first_name, p.second_name, p.last_name, p.second_last_name) "), 'LIKE', "%$search%");
      }
      
    }
}
